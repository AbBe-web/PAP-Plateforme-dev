<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAP ‚Äì G√©n√©rateur de compte-rendu m√©dical</title>

        <link rel="stylesheet" href="../../css/style-global.css">

 </head>
<body>
<div class="container crc-page">
        <div class="rgpd-banner">
            Ce questionnaire, h√©berg√© sur le site Github, ne stocke pas vos donn√©es. Vous pouvez l'imprimer pour votre usage personnel ou m√©dical.
            En continuant, vous acceptez que les donn√©es saisies puissent √™tre affich√©es sur votre √©cran ou imprim√©es.
            <a href="https://abbe-web.github.io/Compte-Rendu-Consultation-PAP/politique-confidentialite.html" target="_blank" rel="noopener noreferrer">Consulter la politique de confidentialit√©</a> |
            <a href="https://www.cnil.fr/fr/les-droits-pour-maitriser-vos-donnees-personnelles" target="_blank" rel="noopener noreferrer">Vos droits (CNIL)</a>
        </div>
     <h1>G√©n√©rateur de compte-rendu ‚Äì Consultation d‚Äôactivit√© physique</h1>

        <p>Veuillez renseigner les diff√©rents items ci-dessous pour g√©n√©rer le compte-rendu. Vous pouvez vous aider du ¬´ Guide Prescription Activit√© Physique et Lutte contre la S√©dentarit√© (¬´ Adulte ¬ª >15 ans) ¬ª</p>
        <form id="consultationForm">
            <div class="form-group">
                <h2>1/ La personne adress√©e est dans une des situations suivantes (page 3) :</h2>
                <label><input type="radio" name="situation" value="symptomes"> Elle a des sympt√¥mes de maladie CV, respiratoire, m√©tabolique et r√©nale d√©compens√©e</label>
                <label><input type="radio" name="situation" value="limitations"> Elle pr√©sente des limitations ou CI √† l‚ÄôAP (tableau 7-9)</label>
                <label><input type="radio" name="situation" value="situations_particulieres"> Elle est dans une des situations particuli√®res (situation 3)</label>
                <label><input type="radio" name="situation" value="aucune"> Votre patient n‚Äôest dans aucune de ces situations</label>
            </div>
            <div class="form-group">
                <h2>2/ √âvaluation de l‚ÄôActivit√© Physique (niveau actuel et vis√©, motivation)</h2>
                <div class="sub-group">
                   <h3>Niveau actuel (mesur√© par <label><input type="radio" name="questionnaire" value="GPAQ"> GPAQ</label>, <label><input type="radio" name="questionnaire" value="Marshall"> Marshall</label>) :</h3>
                    <div style="display: flex; align-items: center;">
                        <div style="margin-right: 20px;">
                            <label><input type="radio" name="niveau_actuel" value="actif"> Actif</label>
                            <div id="actif-subgroup" class="hidden">
                                <label><input type="radio" name="actif_depuis" value="plus_6_mois"> Oui, depuis plus de 6 mois</label>
                                <label><input type="radio" name="actif_depuis" value="moins_6_mois"> Non, depuis moins de 6 mois</label>
                            </div>
                        </div>
                        <div>
                            <label><input type="radio" name="niveau_actuel" value="inactif"> Inactif</label>
                            <div id="inactif-subgroup" class="hidden">
                                <label><input type="radio" name="ap_envisagee" value="oui"> AP envisag√©e dans les 30 jours</label>
                                <label><input type="radio" name="ap_envisagee" value="non"> Pas d‚ÄôAP envisag√©e dans les 30 jours</label>
                            </div>
                        </div>
                    </div>
                   <div>
    <label>
        <input type="radio" name="sedentaire" value="sedentaire">
        S√©dentaire
    </label>

    <label>
        <input type="radio" name="sedentaire" value="non_sedentaire">
        Non s√©dentaire
    </label>

    <label>
        <input type="radio" name="sedentaire" value="non_recherche">
        Statut de s√©dentarit√© non recherch√©
    </label>
</div>
<label>
  Nombre de pas par jour sur le dernier mois :
  <input type="number" name="nombre_pas" min="0" placeholder="Ex : 7500">
</label>

                </div>
                <div class="sub-group">
                    <h3>Niveau vis√© (intensit√©) :</h3>
                    <label><input type="radio" name="niveau_vise" value="faible"> Faible</label>
                    <label><input type="radio" name="niveau_vise" value="modere"> Mod√©r√©</label>
                    <label><input type="radio" name="niveau_vise" value="eleve"> √âlev√©</label>
                </div>
    
 </div>

<div class="form-group">
    <h2>3/ √âvaluation du RCV (tableau 3) :</h2>
    <label><input type="radio" name="rcv" value="faible"> Faible</label>
    <label><input type="radio" name="rcv" value="modere"> Mod√©r√©</label>
    <label><input type="radio" name="rcv" value="eleve_tres_eleve"> √âlev√©/tr√®s √©lev√©</label>
</div>

<div class="form-group">
    <h2>4/ √âvaluation motivationnelle (compl√©ment) :</h2>
    <div class="sub-group">
        <h3 class="black-text">La personne adress√©e pr√©sente les <u>freins</u> suivants :</h3>
        <textarea name="freins"></textarea>
    </div>
    <div class="sub-group">
        <h3 class="black-text">La personne pr√©sente les <u>leviers</u> suivants :</h3>
        <textarea name="leviers"></textarea>
    </div>
    <div class="sub-group">
        <h3 class="black-text">Importance accord√©e √† l‚ÄôAP de 0 √† 10 :</h3>
        <input type="number" name="importance_ap" min="0" max="10">
    </div>
    <div class="sub-group">
        <h3 class="black-text">Confiance en soi pour r√©ussir √† augmenter son niveau d‚ÄôAP de 0 √† 10 :</h3>
        <input type="number" name="confiance_ap" min="0" max="10">
    </div>
</div>

<div class="form-group">
    <h2>5/ Une consultation M√©dicale d‚ÄôAP est pr√©conis√©e :</h2>
    <label><input type="radio" name="consultation_ap" value="oui"> Oui</label>
    <label><input type="radio" name="consultation_ap" value="non"> Non</label>
    <label><input type="radio" name="consultation_ap" value="peut_etre"> Peut √™tre propos√©e</label>
</div>

<div class="form-group">
    <h2>6/ Une √©preuve d‚Äôeffort est pr√©conis√©e :</h2>
    <label><input type="radio" name="epreuve_effort" value="oui"> Oui</label>
    <label><input type="radio" name="epreuve_effort" value="non"> Non</label>
    <label><input type="radio" name="epreuve_effort" value="peut_etre"> Peut √™tre propos√©e</label>
</div>

<div class="form-group">
    <h2>7/ Les objectifs principaux en termes d‚Äôactivit√© physique sont :</h2>
    <textarea name="objectifs_ap"></textarea>
</div>

        
<div class="form-group">
<h2>8/ Je lui ai remis :</h2>

<!-- ================= AEROBIE ================= -->
<div class="sub-group">
  <h3>Une ordonnance d‚ÄôAP a√©robie :</h3>

  <div style="display:flex; align-items:center; gap:15px; flex-wrap:wrap;">

   <label class="inline-option" style="display:flex; align-items:center; gap:6px;">
  <input type="radio" name="ordonnance_aerobie" id="ordonnance_aerobie" value="oui">
  Oui
</label>

<label class="inline-option" style="display:flex; align-items:center; gap:6px;">
  <input type="radio" name="ordonnance_aerobie" value="non">
  Non
</label>

    <div id="ordonnance_aerobie_subgroup" style="display:none; align-items:center; gap:8px;">
      <input type="number" name="fois_aerobie" min="0" max="9"
             style="width:55px; font-size:inherit;">
      <span style="font-size:inherit;">fois par semaine</span>
    </div>

  </div>

  <div id="intensite_aerobie_block" style="display:none; margin-top:8px;">
    <label class="inline-option">
      <input type="radio" name="intensite_aerobie" value="moderee">
      Intensit√© mod√©r√©e
    </label>
    <label class="inline-option">
      <input type="radio" name="intensite_aerobie" value="elevee">
      Intensit√© √©lev√©e
    </label>
  </div>
</div>

<!-- ================= RENFORCEMENT ================= -->
<div class="sub-group">
  <h3>Renforcement musculaire :</h3>

  <div style="display:flex; align-items:center; gap:15px; flex-wrap:wrap;">
    <label class="inline-option" style="display:flex; align-items:center; gap:6px;">
    <input type="radio" name="renforcement_musculaire" id="renforcement_musculaire" value="oui">
      Oui
    </label>
<label class="inline-option" style="display:flex; align-items:center; gap:6px;">
  <input type="radio" name="renforcement_musculaire" value="non">
  Non
</label>

    <div id="renforcement_musculaire_subgroup"
         style="display:none; align-items:center; gap:8px;">
      <input type="number" name="fois_renforcement" min="0" max="9"
             style="width:55px; font-size:inherit;">
      <span style="font-size:inherit;">fois par semaine</span>
    </div>
  </div>
</div>

<!-- ================= SOUPLESSE ================= -->
<div class="sub-group">
  <h3>Travail de souplesse et mobilit√© :</h3>

  <div style="display:flex; align-items:center; gap:15px; flex-wrap:wrap;">
    <label class="inline-option" style="display:flex; align-items:center; gap:6px;">
      <input type="radio" name="souplesse_mobilite" id="souplesse_mobilite" value="oui">
      Oui
    </label>
<label class="inline-option" style="display:flex; align-items:center; gap:6px;">
  <input type="radio" name="souplesse_mobilite" value="non">
  Non
</label>

    <div id="souplesse_mobilite_subgroup"
         style="display:none; align-items:center; gap:8px;">
      <input type="number" name="fois_souplesse" min="0" max="9"
             style="width:55px; font-size:inherit;">
      <span style="font-size:inherit;">fois par semaine</span>
    </div>
  </div>
</div>

<!-- ================= FICHES ================= -->
<div class="sub-group">
  <h3 class="black-text">Des fiches de promotion d'activit√© physique :</h3>
  <label class="inline-option"><input type="radio" name="fiches_promotion" value="oui"> Oui</label>
  <label class="inline-option"><input type="radio" name="fiches_promotion" value="non"> Non</label>
</div>

</div>

   
            <div class="form-group">
                <h2>9/ La personne adress√©e est :</h2>
<label class="inline-option"><input type="radio" name="sexe" value="femme"> Une femme</label>
<label class="inline-option"><input type="radio" name="sexe" value="homme"> Un homme</label>

            </div>
            <div class="form-group">
                <h2>10/ Le destinataire du courrier est :</h2>
              <label class="inline-option"><input type="radio" name="destinataire" value="consoeur"> Une cons≈ìur</label>
<label class="inline-option"><input type="radio" name="destinataire" value="confrere"> Un confr√®re</label>

            </div>
           <button type="button" id="generateReport" class="btn">G√©n√©rer le compte-rendu</button>
        </form>
       <div id="reportOutput" class="hidden">
    <p id="reportText"></p>
    <button type="button" id="printReport" class="btn">Imprimer</button>
    <button type="button" id="copyReport" class="btn">Copier le CRC</button>
</div>

    </div>
    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input[name="niveau_actuel"]').forEach(function(radio) {
                radio.addEventListener('change', function() {
                    if (this.value === 'actif') {
                        document.getElementById('actif-subgroup').classList.remove('hidden');
                        document.getElementById('inactif-subgroup').classList.add('hidden');
                    } else if (this.value === 'inactif') {
                        document.getElementById('inactif-subgroup').classList.remove('hidden');
                        document.getElementById('actif-subgroup').classList.add('hidden');
                    } else {
                        document.getElementById('actif-subgroup').classList.add('hidden');
                        document.getElementById('inactif-subgroup').classList.add('hidden');
                    }
                });
          });
            
function toggleSubgroup(groupName, subgroupId, extraBlockId = null) {
  const radios = document.querySelectorAll(`input[name="${groupName}"]`);
  const subgroup = document.getElementById(subgroupId);
  const extraBlock = extraBlockId ? document.getElementById(extraBlockId) : null;

  if (!radios || !subgroup) return;

  function resetFields() {
    // Vider les inputs number dans le sous-bloc
    subgroup.querySelectorAll('input[type="number"]').forEach(input => {
      input.value = "";
    });

    // D√©cocher les radios √©ventuelles dans le bloc suppl√©mentaire
    if (extraBlock) {
      extraBlock.querySelectorAll('input[type="radio"]').forEach(radio => {
        radio.checked = false;
      });
    }
  }

  function updateDisplay() {
    const selected = document.querySelector(`input[name="${groupName}"]:checked`);

    if (selected && selected.value === "oui") {
      subgroup.style.display = "flex";
      if (extraBlock) extraBlock.style.display = "block";
    } else {
      subgroup.style.display = "none";
      if (extraBlock) extraBlock.style.display = "none";
      resetFields(); // üëà nettoyage automatique
    }
  }

  radios.forEach(radio => {
    radio.addEventListener("change", updateDisplay);
  });

  updateDisplay(); // √©tat initial
}

toggleSubgroup("ordonnance_aerobie", "ordonnance_aerobie_subgroup", "intensite_aerobie_block");
toggleSubgroup("renforcement_musculaire", "renforcement_musculaire_subgroup");
toggleSubgroup("souplesse_mobilite", "souplesse_mobilite_subgroup");
         
            function buildClinicalModel() {
  return {

    meta: {
      destinataire: document.querySelector('input[name="destinataire"]:checked')?.value || "standard"
    },

    situation: document.querySelector('input[name="situation"]:checked')?.value || null,

    patient: {
      sexe: document.querySelector('input[name="sexe"]:checked')?.value || "homme",
      questionnaire: document.querySelector('input[name="questionnaire"]:checked')?.value || null,
      pas_moyens: document.querySelector('input[name="nombre_pas"]')?.value || null
    },

    evaluation: {
      niveau_retenu: document.querySelector('input[name="niveau_actuel"]:checked')?.value || null,
      sedentarite: document.querySelector('input[name="sedentaire"]:checked')?.value || null,
      rcv: document.querySelector('input[name="rcv"]:checked')?.value || null
    },

    motivation: {
      stade: getStadeMotivation(),
      importance: document.querySelector('input[name="importance_ap"]')?.value || null,
      confiance: document.querySelector('input[name="confiance_ap"]')?.value || null,
      freins: document.querySelector('textarea[name="freins"]')?.value || null,
      leviers: document.querySelector('textarea[name="leviers"]')?.value || null
    },

    therapeutic_plan: {
      objectif_principal: document.querySelector('textarea[name="objectifs_ap"]')?.value || null,
      indicateur_cible_libre: null
    },

    prescription: {
      aerobie: {
        frequence: document.querySelector('input[name="fois_aerobie"]')?.value || null,
        intensite: document.querySelector('input[name="intensite_aerobie"]:checked')?.value || null
      },
      renforcement: {
        frequence: document.querySelector('input[name="fois_renforcement"]')?.value || null
      },
      souplesse: {
        frequence: document.querySelector('input[name="fois_souplesse"]')?.value || null
      }
    },

    decision: {
      specialite: "aucune", // on structurera l‚Äôinterface ensuite
      autre_specialite: null,
      epreuve_effort: document.querySelector('input[name="epreuve_effort"]:checked')?.value || null
    }

  };
}
        document.getElementById('generateReport').addEventListener('click', function() {

  const model = buildClinicalModel();
  const reportText = renderLongLetterV2(model);

  document.getElementById('reportText').innerHTML = reportText;
  document.getElementById('reportOutput').classList.remove('hidden');
  document.getElementById('reportOutput').scrollIntoView({ behavior: 'smooth', block: 'start' });

});
            document.getElementById('printReport').addEventListener('click', function() {
                window.print();
            });
            document.getElementById('copyReport').addEventListener('click', function() {
                const reportText = document.getElementById('reportText').innerText;
                navigator.clipboard.writeText(reportText).then(function() {
                    alert('Le compte-rendu a √©t√© copi√© dans le presse-papiers.');
                }).catch(function(err) {
                    console.error('Erreur lors de la copie du texte: ', err);
                });
            });
            function getStadeMotivation() {
                const niveauActuel = document.querySelector('input[name="niveau_actuel"]:checked') ? document.querySelector('input[name="niveau_actuel"]:checked').value : '';
                if (niveauActuel === 'actif') {
                    const actifDepuis = document.querySelector('input[name="actif_depuis"]:checked') ? document.querySelector('input[name="actif_depuis"]:checked').value : '';
                    return actifDepuis === 'plus_6_mois' ? 'consolidation' : 'action';
                } else if (niveauActuel === 'inactif') {
                    const apEnvisagee = document.querySelector('input[name="ap_envisagee"]:checked') ? document.querySelector('input[name="ap_envisagee"]:checked').value : '';
                    return apEnvisagee === 'oui' ? 'pr√©paration' : 'intention';
                }
                return 'ind√©termination';
            }
            function getStadeMotivationText() {
                const niveauActuel = document.querySelector('input[name="niveau_actuel"]:checked') ? document.querySelector('input[name="niveau_actuel"]:checked').value : '';
                if (niveauActuel === 'actif') {
                    return 'Statut actif';
                } else if (niveauActuel === 'inactif') {
                    return 'Statut inactif';
                }
                return 'Statut ind√©termin√©';
            }
            function getMotivationText() {
                const niveauActuel = document.querySelector('input[name="niveau_actuel"]:checked') ? document.querySelector('input[name="niveau_actuel"]:checked').value : '';
                if (niveauActuel === 'actif') {
                    const actifDepuis = document.querySelector('input[name="actif_depuis"]:checked') ? document.querySelector('input[name="actif_depuis"]:checked').value : '';
                    return actifDepuis === 'plus_6_mois' ? '(Actif depuis plus de 6 mois)' : '(Actif depuis moins de 6 mois)';
                } else if (niveauActuel === 'inactif') {
                    const apEnvisagee = document.querySelector('input[name="ap_envisagee"]:checked') ? document.querySelector('input[name="ap_envisagee"]:checked').value : '';
                    return apEnvisagee === 'oui' ? '(AP envisag√©e dans les 30 jours)' : '(pas d‚ÄôAP envisag√©e dans les 30 jours)';
                }
                return '';
            }
            function getConsultationText(value) {
                switch(value) {
                    case 'oui': return 'est pr√©conis√©e.';
                    case 'non': return 'n‚Äôest pas pr√©conis√©e.';
                    case 'peut_etre': return 'peut √™tre propos√©e.';
                    default: return '';
                }
            }
            function getEpreuveEffortText(value) {
                switch(value) {
                    case 'oui': return 'est pr√©conis√©e.';
                    case 'non': return 'n‚Äôest pas pr√©conis√©e.';
                    case 'peut_etre': return 'peut √™tre propos√©e.';
                    default: return '';
                }
            }
            function getNiveauViseText(value) {
                switch(value) {
                    case 'faible': return 'faible';
                    case 'modere': return 'mod√©r√©';
                    case 'eleve': return '√©lev√©';
                    default: return '';
                }
            }
            function getRcvText(value) {
                switch(value) {
                    case 'faible': return 'faible';
                    case 'modere': return 'mod√©r√©';
                    case 'eleve_tres_eleve': return '√©lev√©/tr√®s √©lev√©';
                    default: return '';
                }
            }
            function renderLongLetterV2(model) {

  const p = model.patient;
  const e = model.evaluation;
  const m = model.motivation;
  const t = model.therapeutic_plan;
  const pr = model.prescription;

  const salutations =
    model.meta.destinataire === "consoeur" ? "Ch√®re cons≈ìur," :
    model.meta.destinataire === "confrere" ? "Cher confr√®re," :
    "Madame, Monsieur,";

  const titre = p.sexe === "femme" ? "Madame" : "Monsieur";
  const pronom = p.sexe === "femme" ? "elle" : "il";
  const pronomMaj = p.sexe === "femme" ? "Elle" : "Il";

  return `
    <p>${salutations}</p>

    <p>Merci de m‚Äôavoir adress√© ${titre} _____ en consultation √©ventuelle d‚Äôactivit√© physique.</p>

    <p><strong>√âvaluation de l‚Äôactivit√© physique :</strong><br>
    Niveau actuel : ${e.niveau_retenu || "non pr√©cis√©"}.
    ${p.pas_moyens ? `Nombre de pas : environ ${p.pas_moyens} pas/jour.` : ""}
    ${e.sedentarite ? `Statut : ${e.sedentarite}.` : ""}
    </p>

    <p><strong>√âvaluation motivationnelle :</strong><br>
    Stade : ${m.stade || "non pr√©cis√©"}.
    Importance : ${m.importance || "‚Äî"}/10.
    Confiance : ${m.confiance || "‚Äî"}/10.
    ${m.freins ? `Freins : ${m.freins}.` : ""}
    ${m.leviers ? `Leviers : ${m.leviers}.` : ""}
    </p>

    <p><strong>Risque cardiovasculaire :</strong> ${e.rcv || "non pr√©cis√©"}.</p>

    <p><strong>Objectifs :</strong><br>
    ${t.objectif_principal || ""}
    </p>

    <p><strong>Prescription :</strong><br>
    ${pr.aerobie.frequence ? `A√©robie : ${pr.aerobie.frequence} fois/semaine.` : ""}
    ${pr.renforcement.frequence ? `Renforcement : ${pr.renforcement.frequence} fois/semaine.` : ""}
    ${pr.souplesse.frequence ? `Souplesse : ${pr.souplesse.frequence} fois/semaine.` : ""}
    </p>

    <p>Bien confraternellement.</p>
  `;
}
        });
    </script>
</body>
</html>
